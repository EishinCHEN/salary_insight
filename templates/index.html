<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è–ªè³‡åˆ†å¸ƒåˆ†æ</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    #salary-chart { width: 100%; height: 600px; }
    #loading {
      display: none;
      text-align: center;
      margin-top: 20px;
    }
    #loading img {
      width: 100px;
    }
  </style>
</head>
<body>

<h2>104 äººåŠ›éŠ€è¡Œ è–ªè³‡åˆ†å¸ƒåˆ†æ</h2>

<label for="job-title">è«‹è¼¸å…¥è·ç¼ºé—œéµå­—ï¼š</label>
<input type="text" id="job-title" placeholder=".NET" />
<button onclick="search()">æœå°‹</button>

<!-- ğŸ”¥ åŠ ä¸Šé€™æ®µ loading ç•«é¢ -->
<div id="loading">
  <p>è³‡æ–™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œ...</p>
  <img src="https://i.gifer.com/ZZ5H.gif" alt="Loading...">
</div>

<div id="salary-chart"></div>

<script>
function search() {
  const title = document.getElementById("job-title").value || ".NET";

  // ğŸ”¥ é¡¯ç¤º loading
  document.getElementById("loading").style.display = "block";
  document.getElementById("salary-chart").innerHTML = ""; // æ¸…ç©ºèˆŠåœ–

  fetch(`/search?title=${encodeURIComponent(title)}`)
    .then(response => response.json())
    .then(data => {
      // ğŸ”¥ éš±è— loading
      document.getElementById("loading").style.display = "none";

      if (data.salaries.length === 0) {
        alert("æ‰¾ä¸åˆ°ç›¸é—œè·ç¼ºï¼");
        return;
      }
      plotSalary(data.salaries, data.salary_type);
    })
    .catch(error => {
      document.getElementById("loading").style.display = "none";
      alert("æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
      console.error(error);
    });
}

function plotSalary(salaries, title) {
  const trace = {
    x: salaries,
    type: 'histogram',
    marker: {color: "skyblue"},
    xbins: {size: 5000}
  };
  const layout = {
    title: `${title}è·ç¼ºçš„å¹³å‡è–ªè³‡åˆ†å¸ƒ`,
    xaxis: {title: "å¹³å‡è–ªè³‡ (å…ƒ)"},
    yaxis: {title: "è·ç¼ºæ•¸é‡"},
    bargap: 0.05
  };
  Plotly.newPlot('salary-chart', [trace], layout);
}

// é è¨­è¼‰å…¥ .NET
search();
</script>

</body>
</html>
